const localDescription=document.getElementById("localDescription"),remoteDescription=document.getElementById("remoteDescription"),chatBox=document.getElementById("chatBox"),messageInput=document.getElementById("message"),sendMessageButton=document.getElementById("sendMessage"),generateOfferButton=document.getElementById("generateOffer"),connectButton=document.getElementById("connect"),container=document.querySelector(".container"),copyOfferButton=document.getElementById("copyOffer");let peerConnection=new RTCPeerConnection,dataChannel;function displayMessage(e,t){let n=document.createElement("div");n.className=`chat-message ${t}`,n.textContent=e,chatBox.appendChild(n),chatBox.scrollTop=chatBox.scrollHeight}function showChatUI(){localDescription.style.display="none",remoteDescription.style.display="none",generateOfferButton.style.display="none",connectButton.style.display="none",copyOfferButton.style.display="none",chatBox.style.display="block",messageInput.style.display="block",sendMessageButton.style.display="block"}peerConnection.ondatachannel=e=>{(dataChannel=e.channel).onmessage=e=>{displayMessage(e.data,"received")}},generateOfferButton.addEventListener("click",async()=>{(dataChannel=peerConnection.createDataChannel("chat")).onmessage=e=>{displayMessage(e.data,"received")};let e=await peerConnection.createOffer();await peerConnection.setLocalDescription(e),localDescription.value=JSON.stringify(peerConnection.localDescription)}),connectButton.addEventListener("click",async()=>{let e=JSON.parse(remoteDescription.value);if(await peerConnection.setRemoteDescription(new RTCSessionDescription(e)),"offer"===e.type){let t=await peerConnection.createAnswer();await peerConnection.setLocalDescription(t),localDescription.value=JSON.stringify(peerConnection.localDescription)}peerConnection.onconnectionstatechange=()=>{"connected"===peerConnection.connectionState&&showChatUI()}}),sendMessageButton.addEventListener("click",()=>{let e=messageInput.value.trim();e&&dataChannel&&(dataChannel.send(e),displayMessage(e,"sent"),messageInput.value="")}),peerConnection.onicecandidate=e=>{if(e.candidate){let t=JSON.stringify(peerConnection.localDescription);localDescription.value=t}},copyOfferButton.addEventListener("click",()=>{let e=localDescription.value.trim();e?navigator.clipboard.writeText(e).then(()=>{console.log("Offer copied to clipboard!")}).catch(e=>{console.error("Failed to copy offer:",e)}):alert("No offer to copy. Please generate an offer first.")});
